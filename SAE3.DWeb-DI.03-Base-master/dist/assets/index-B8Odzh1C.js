(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function r(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(o){if(o.ep)return;o.ep=!0;const i=r(o);fetch(o.href,i)}})();let q="https://mmi.unilim.fr/~lajudie6/SAE3.DWeb-DI.03-Base/api/",s=async function(e){let t={method:"GET"};try{var r=await fetch(q+e,t)}catch(o){return console.error("Echec de la requête : "+o),!1}return r.status!=200?(console.error("Erreur de requête : "+r.status),!1):await r.json()},g=async function(e,t){let r={method:"POST",body:t};try{var n=await fetch(q+e,r)}catch(i){return console.error("Echec de la requête : "+i),!1}return n.status!=200?(console.error("Erreur de requête : "+n.status),!1):await n.json()},u={};u.fetch=async function(e){return await s("movies/"+e)};u.fetchAll=async function(){return await s("movies")};u.save=async function(e){return await g("movies",e)};u.getTop3=async function(){return await s("movies/top3")};u.historyByTitle=async function(e){return await s("movies/historyByTitle?movie_title="+e)};u.movieCustomer=async function(e){return await s("movies/movie?customer="+e)};u.movieConsoParPays=async function(e){return await s("movies/movieConsoParPays?month="+e)};u.getMonth=async function(){return await s("movies/getMonth")};let f=function(e,t){let r=e;for(let n in t)r=r.replaceAll(new RegExp("{{"+n+"}}","g"),t[n]);return r};const T=await fetch("src/ui/movie/template.html"),M=await T.text();let L={render:function(e){let t="";Array.isArray(e)||(e=[e]);for(let r of e)t+=f(M,r);return t}},m={};m.fetch=async function(e){return await s("sales/"+e)};m.fetchAll=async function(){return await s("sales")};m.save=async function(e){return await g("sales",e)};m.getTotalSales=async function(){return await s("sales/salesThisMonth")};m.getSalesEvolution=async function(){return await s("sales/salesEvolution")};m.salesGenreEvolution=async function(){return await s("sales/salesGenreEvolution")};m.SalesByCountry=async function(){return await s("sales/salesByCountry")};const R=await fetch("src/ui/top/template.html"),G=await R.text();let b={render:function(e){let t="";Array.isArray(e)||(e=[e]);for(let r of e)t+=f(G,r);return t}},y={};y.fetch=async function(e){return await s("rentals/"+e)};y.fetchAll=async function(){return await s("rentals")};y.save=async function(e){return await g("rentals",e)};y.getRentalSales=async function(){return await s("rentals/rentalThisMonth")};y.getRentalsEvolution=async function(){return await s("rentals/rentalEvolution")};y.rentalGenreEvolution=async function(){return await s("rentals/rentalGenreEvolution")};y.RentalsByCountry=async function(){return await s("rentals/rentalByCountry")};const j=await fetch("src/ui/evolution/template.html"),D=await j.text();let H={render:function(e){let t="";Array.isArray(e)||(e=[e]);for(let r of e)t+=f(D,r);return t}};const F=await fetch("src/ui/genre/template.html"),$=await F.text();let _={render:function(e){let t="";Array.isArray(e)||(e=[e]);for(let r of e)t+=f($,r);return t}};const B=await fetch("src/ui/country/template.html");await B.text();const O=await fetch("src/ui/history/template.html"),P=await O.text();let V={render:function(e){let t="";Array.isArray(e)||(e=[e]);for(let r of e)t+=f(P,r);return t}},S={};S.fetch=async function(e){return await s("customers/"+e)};S.fetchAll=async function(){return await s("customers")};S.save=async function(e){return await g("customers",e)};const N=await fetch("src/ui/customer/template.html"),I=await N.text();let z={render:function(e){let t="";Array.isArray(e)||(e=[e]);for(let r of e)t+=f(I,r);return t}};const k=await fetch("src/ui/month/template.html"),W=await k.text();let K={render:function(e){let t="";Array.isArray(e)||(e=[e]);for(let r of e)t+=f(W,r);return t}},l={};l.init=async function(){a.init()};let a={movies:document.querySelector("#movie"),top3:document.querySelector("#top"),topRentals:document.querySelector("#topRentals"),evolution:document.querySelector("#evolution"),genre:document.querySelector("#genre"),country:document.querySelector("#country"),history:document.querySelector("#historySelect"),customerName:document.querySelector("#customerName"),month:document.querySelector("#month"),monthData:document.querySelector("#monthData")};a.init=async function(){l.loadTop(),l.loadMovies(),l.loadEvolution(),l.loadGenre(),l.loadCountry(),l.loadHistory(),l.loadCustomer(),await l.loadMonth(),l.loadConsommation()};l.loadMovies=async function(){try{let e=await m.getTotalSales(),t=await y.getRentalSales();a.renderMovies(e,t)}catch(e){console.error("Error loading movies:",e)}};a.renderMovies=function(e,t){a.movies.innerHTML=L.render(e,t);const n=new Date().toISOString().slice(0,7);var o={series:[{name:"sales",data:[{x:"Top vente du "+n,y:e,fillColor:"#008FFB"},{x:"Top location du "+n,y:t,fillColor:"#00E396"}]}],chart:{type:"bar",height:403.75},xaxis:{type:"category",labels:{fontWeight:700},categories:["Ventes","Locations"]},title:{text:"Montant total des ventes et le montant total des locations pour le mois en cours"},yaxis:{labels:{formatter:function(c){return c+" €"}}}},i=new ApexCharts(document.querySelector("#chart"),o);i.render()};l.loadTop=async function(){try{let e=await u.getTop3(),t=e.slice(0,3),r=e.slice(3);a.renderTop(t,r)}catch(e){console.error("Error loading top movies:",e)}};a.renderTop=function(e,t){a.top3.innerHTML=b.render(e),a.topRentals.innerHTML=b.render(t)};l.loadEvolution=async function(){try{let e=await y.getRentalsEvolution(),t=await m.getSalesEvolution();a.renderEvolution(e,t)}catch(e){console.error("Error loading evolution:",e)}};a.renderEvolution=function(e,t){a.evolution.innerHTML=H.render(e,t);var r={series:[{name:"Evolution des locations",data:e.map(o=>o.total_rentals).reverse()},{name:"Evolution des ventes",data:t.map(o=>o.total_sales).reverse()}],chart:{height:350,type:"line",zoom:{enabled:!1}},dataLabels:{enabled:!1},stroke:{curve:"straight"},title:{text:"Ventes et location lors des 6 derniers mois",align:"left"},grid:{row:{colors:["#f3f3f3","transparent"],opacity:.5}},xaxis:{categories:e.map(o=>o.month).reverse()}},n=new ApexCharts(document.querySelector("#chartEvo"),r);n.render()};l.loadGenre=async function(){let e=document.querySelector("#genreSelect").value;if(e==="sales"){let t=await m.salesGenreEvolution();a.renderGenre(t,[])}else if(e==="rentals"){let t=await y.rentalGenreEvolution();a.renderGenre([],t)}else{let t=await m.salesGenreEvolution(),r=await y.rentalGenreEvolution();a.renderGenre(t,r)}};a.renderGenre=function(e,t){a.genre.innerHTML=_.render();let r=e.concat(t);var n=["Animation","Comedy","Drama","Sci-Fi","Thriller","Action","Romance","Horror"],o=[...new Set(r.map(d=>d.month))].sort();var i=n.map((d,h)=>({name:d,data:o.map(p=>{var x=r.find(A=>A.genre==d&&A.month==p);return x?x.total_sales||x.total_rentals:0}),color:c(h)}));function c(d){var h=["#008FFB","#00E396","#775DD0","#FEB019","#FF4560","#A2A2A4","#8D6E63","#E9EB58"];return h[d%h.length]}var E={series:i,chart:{type:"bar",height:350,stacked:!0},plotOptions:{bar:{horizontal:!0,dataLabels:{total:{enabled:!0,style:{fontSize:"13px",fontWeight:900}}}}},stroke:{width:1,colors:["#fff"]},title:{text:"Ventes et locations par genre lors des 6 derniers mois"},xaxis:{categories:o,labels:{formatter:function(d){return d}}},yaxis:{title:{text:void 0}},tooltip:{y:{formatter:function(d){return d}}},fill:{opacity:1},legend:{position:"top",horizontalAlign:"left",offsetX:40}},C=new ApexCharts(document.querySelector("#chartGenre"),E);C.render()};document.querySelector("#genreSelect").addEventListener("change",l.loadGenre);l.loadCountry=async function(){try{let e=await m.SalesByCountry(),t=await y.RentalsByCountry();a.renderCountry(e,t)}catch(e){console.error("Error loading country:",e)}};a.renderCountry=function(e,t){var r={series:[{name:"Sales",data:e.map(n=>({x:n.country,y:n.total_sales}))},{name:"Rentals",data:t.map(n=>({x:n.country,y:n.total_rentals}))}],legend:{show:!1},chart:{height:350,type:"treemap"},title:{text:"Vente et location par pays"}};a.chart?a.chart.updateOptions(r):(a.chart=new ApexCharts(document.querySelector("#countryData"),r),a.chart.render())};let v;l.loadHistory=async function(){let e=document.querySelector("#historySelect").value;(!e||e==="0")&&(e="Love Is All There Is");try{let t=await u.historyByTitle(e),r=[];(!e||e==="Love Is All There Is")&&(r=await u.fetchAll()),a.renderHistory(t,r)}catch(t){console.error("Error loading history:",t)}};a.renderHistory=function(e,t){a.history.innerHTML||(a.history.innerHTML=V.render(t));let r=document.querySelector("#historySelect").value,n=e.map(c=>c.rentals_count),o=e.map(c=>c.sales_count);var i={series:[{name:"Evolution des locations",data:n},{name:"Evolution des ventes",data:o}],chart:{height:350,type:"line",zoom:{enabled:!1}},dataLabels:{enabled:!1},stroke:{curve:"straight"},title:{text:"Ventes et locations pour "+r,align:"left"},grid:{row:{colors:["#f3f3f3","transparent"],opacity:.5}},xaxis:{categories:e.map(c=>c.month)}};v&&v.destroy(),v=new ApexCharts(document.querySelector("#history"),i),v.render()};document.querySelector("#historySelect").addEventListener("change",l.loadHistory);l.loadCustomer=async function(){let e=document.querySelector("#customerName").value;(!e||e==="0")&&(e="1");try{let t=await u.movieCustomer(e),r=[];document.querySelector("#customerName").value||(r=await S.fetchAll()),a.renderCustomer(t,r)}catch(t){console.error("Error loading customers:",t)}};let w;a.renderCustomer=function(e,t){a.customerName.innerHTML||(a.customerName.innerHTML=z.render(t));let r=e.reduce((o,i)=>(o[i.genre]=(o[i.genre]||0)+1,o),{});var n={series:Object.values(r),chart:{width:380,type:"pie"},labels:Object.keys(r),tooltip:{y:{formatter:function(o,{series:i,seriesIndex:c,dataPointIndex:E,w:C}){let d=Object.keys(r)[E],h=e.filter(p=>p.genre===d).map(p=>p.movie_title).join(`,
`);return d+": "+o+" ("+h+")"}}},responsive:[{breakpoint:480,options:{chart:{width:200},legend:{position:"bottom"}}}]};w&&w.destroy(),w=new ApexCharts(document.querySelector("#customer"),n),w.render()};document.querySelector("#customerName").addEventListener("change",l.loadCustomer);l.loadMonth=async function(){try{let e=await u.getMonth();a.renderMonth(e)}catch(e){console.error("Error loading month:",e)}};a.renderMonth=function(e){a.month.innerHTML=K.render(e)};l.loadConsommation=async function(){let e=document.querySelector("#month").value;try{let t=await u.movieConsoParPays(e);a.renderConsommation(t)}catch(t){console.error("Error loading country:",t)}};a.renderConsommation=function(e){a.monthData.innerHTML="";var t={series:[{name:"Series 1",data:e.map(n=>n.total_gb_consumed)}],chart:{height:350,type:"radar"},title:{text:"Co2 consommé par pays le "+document.querySelector("#month").value},yaxis:{stepSize:20},xaxis:{categories:e.map(n=>n.country)}},r=new ApexCharts(document.querySelector("#monthData"),t);r.render()};document.querySelector("#month").addEventListener("change",l.loadConsommation);l.init();
